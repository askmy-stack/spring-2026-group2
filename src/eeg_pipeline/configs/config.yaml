# src/configs/config.yaml  (EEG pipeline config)

run:
  diagrams: true
  preprocess: true
  eda: true

dataset:
  bids_root: "results/bids_dataset"

bids:
  datatype: "eeg"
  suffix: "eeg"
  extension: ".edf"

# NEW: window index produced by dataloader (already labeled)
dataloader_index:
  csv_paths:
    - "results/dataloader/window_index_train.csv"
    - "results/dataloader/window_index_val.csv"
    - "results/dataloader/window_index_test.csv"
  columns:
    path: "path"
    subject_id: "subject_id"
    start_sec: "start_sec"
    end_sec: "end_sec"
    label: "label"
    age: "age"
    sex: "sex"

outputs:
  eda_root: "results/preprocess/eda"
  diagrams_root: "results/preprocess/diagrams"
  overview_root: "results/preprocess/overview"

preprocess:
  filtering:
    enabled: true
    l_freq: 1.0
    h_freq: 60.0
    notch_freqs: [60.0]
    method: "iir"
    iir_params:
      order: 4
      ftype: "butter"

  wavelet_denoise:
    enabled: false
    family: "db4"
    level: null
    threshold: "soft"

analysis:
  time_domain:
    reref:
      enabled: false
      ref_channels: null
      projection: false

    qc:
      enabled: true
      max_abs_uV: 500.0
      flat_var_thresh_uV2: 1.0e-12
      nan_allowed: false
      noisy_var_factor: 10.0

    bad_channels:
      min_good_channels: 4
      enabled: true
      use_qc_rules: true
      interpolate: false
      require_montage: false

    epoching:
      enabled: true
      length_sec: 2.0
      overlap_sec: 0.0
      baseline: null

    artifact_rejection:
      enabled: false
      reject:
        eeg: 0.00015
      flat:
        eeg: 0.0000002
#
#    ica:
#      enabled: false
#      method: "fastica"
#      n_components: null
#      random_state: 42
#      max_iter: 512
#      eog_channel: null
#      auto_detect: false


  frequency_domain:
    psd:
      enabled: true
      method: "welch"
      fmin: 0.5
      fmax: 70.0

    bandpower:
      enabled: true
      bands:
        delta: [0.5, 4.0]
        theta: [4.0, 8.0]
        alpha: [8.0, 13.0]
        beta:  [13.0, 30.0]
        gamma: [30.0, 70.0]

    # --- PSD spectrogram ---
    spectrogram:
      enabled: true
      pick_channel: null
      win_sec: 2.0
      step_sec: 0.25
      scale: "db"
      bandwidth: null
      adaptive: true
      low_bias: true

    # --- FFT ---
    fft:
      enabled: true
      pick_channel: null
      tmin: 0.0
      tmax: 2.0
      detrend: "constant"
      window: "hann"
      fmin: 0.5
      fmax: 70.0

    # --- Morlet spectrogram (TFR) ---
    morlet:
      enabled: true
      pick_channel: null
      aggregate: "none"
      fmin: 2.0
      fmax: 70.0
      n_freqs: 30
      n_cycles: 3
      decim: 1
      scale: "db"


  time_frequency:
    enabled: true
    stft:
      enabled: true
    morlet_tfr:
      enabled: false

export_cleaned:
  enabled: true
  out_root: "results/preprocess/bids_dataset"


eda:
  save_csv: true
  save_plots: true
  seconds_to_plot: 10.0
  max_channels_plot: null
  plot_raw_vs_filtered: true
  plot_psd_per_channel: true
  save_psd_per_channel_csv: false

  recording_level:
    enabled: true
  window_level:
    enabled: false

  max_windows_total: 10
  max_windows_per_subject: 20
  only_label: null

overview:
  windows_columns:
    - rid
    - subject_id
    - label
    - start_sec
    - end_sec
    - duration_sec
    - qc_noisy_frac
    - n_bads
    - qc_json